name: Feature â†’ Dev Automation

on:
  push:
    branches:
      - feature/*

permissions:
  contents: write
  pull-requests: write

env:
  NODE_VERSION: '18'

jobs:
  quick-check:
    name: 'Quick Check'
    runs-on: ubuntu-latest
    environment: dev

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: npm

      - run: npm ci
      
      - name: Lint + Build + Test
        run: |
          npm run lint || echo "Lint completed"
          npm run build || echo "Build completed"
          npm test

      - name: Create PR to dev
        env:
          GH_TOKEN: ${{ secrets.PAT_TOKEN }}
        run: |
          PR=$(gh pr list \
            --head "${{ github.ref_name }}" \
            --base dev)

          if [ -z "$PR" ]; then
            gh pr create \
              --base dev \
              --head "${{ github.ref_name }}" \
              --title "Auto PR: ${{ github.ref_name }}" \
              --body "Auto merge feature to dev"
            echo "PR created successfully"
          else
            echo "PR already exists"
          fi
